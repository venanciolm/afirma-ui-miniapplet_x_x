<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<title>Sample Page</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1" />
<link rel="shortcut icon" type="image/png" href="/favicon.ico" />
<script type="text/javascript" src="jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="afirma-jnlp.js"></script>
<script type="text/javascript">
	var pageSuccessCallback = function(/*Anything*/response, /*String*/
	textStatus, /*jqXHR*/
	jqXHR) {
		var value = "id: " + response.id;
		value += "\n" + "type: " + response.type;
		value += "\n" + "time: " + response.time;
		value += "\n" + "error: " + response.error;
		value += "\n" + "descError: " + response.descError;
		value += "\n";
		value += "\n" + "textStatus: " + textStatus;
		$("#console").val(value);
	};
	var pageErrorCallback = function(/*jqXHR*/jqXHR,/*String*/textStatus,/*String*/
	errorThrown) {
		$("#console").val(errorThrown);
	};
	var pageBeforeSendCallback=function(/*jqXHR*/jqXHR, /*PlainObject*/
			settings) {
				$("#resultado").html("Procesando, espere por favor...");
				$('#preloader').show();
			};
	var pageCompleteCallback = function( /*jqXHR*/jqXHR, /*String*/
			textStatus) {
				$("#resultado").html(textStatus);
				$('#preloader').hide();
			};

	function showLogCallback(errorType, errorMessage) {
		showLog("Type: " + errorType + "\nMessage: " + errorMessage);
	}

	function echo() {
		var invoker = new AfirmaClient();
		invoker.setCommand("echo");
		invoker.setSuccessCallback(function(/*Anything*/response, /*String*/textStatus, /*jqXHR*/
		jqXHR) {
			pageSuccessCallback(response, textStatus, jqXHR);
			$("#outputText").val(response.msg);
		});
		invoker.setErrorCallback(pageErrorCallback);
		invoker.setBeforeSendCallback(pageBeforeSendCallback);
		invoker.setCompleteCallback(pageCompleteCallback);
		invoker.invoke(undefined);
	}
	function openWindow() {
		var invoker = new AfirmaClient();
		invoker.setCommand("open");
		invoker.setSuccessCallback(pageSuccessCallback);
		invoker.setErrorCallback(pageErrorCallback);
		invoker.setBeforeSendCallback(pageBeforeSendCallback);
		invoker.setCompleteCallback(pageCompleteCallback);
		invoker.invoke(undefined);
	}
	function exit_jnlp() {
		var invoker = new AfirmaClient();
		invoker.setCommand("exit");
		invoker.setSuccessCallback(pageSuccessCallback);
		invoker.setErrorCallback(pageErrorCallback);
		invoker.setBeforeSendCallback(pageBeforeSendCallback);
		invoker.setCompleteCallback(pageCompleteCallback);
		invoker.invoke(undefined);
	}
	function test() {
		var invoker = new AfirmaClient();
		invoker.setCommand("test");
		invoker.setSuccessCallback(pageSuccessCallback);
		invoker.setErrorCallback(pageErrorCallback);
		invoker.setBeforeSendCallback(pageBeforeSendCallback);
		invoker.setCompleteCallback(pageCompleteCallback);
		invoker.invoke(undefined);
	}

	function getBase64FromText() {
		var item = {
			plainText : $("#inputText").val(),
			charset : "default"
		};
		console.log("Enviando: " + item.plainText);
		var invoker = new AfirmaClient();
		invoker.setCommand("getBase64FromText");
		invoker.setSuccessCallback(function(/*Anything*/response, /*String*/
				textStatus, /*jqXHR*/
				jqXHR) {
					pageSuccessCallback(response, textStatus, jqXHR);
					$("#outputText").val(response.msg);
				});
		invoker.setErrorCallback(pageErrorCallback);
		invoker.setBeforeSendCallback(pageBeforeSendCallback);
		invoker.setCompleteCallback(pageCompleteCallback);
		invoker.invoke(item);
	}

	function sign(base64) {
		var item = {
			algorithm : 'SHA512withRSA',
			format : 'XAdES',
			extraParams : 'format=XAdES Enveloping'
		};
		var invoker = new AfirmaClient();
		invoker.setCommand("sign");
		invoker.setSuccessCallback(function(/*Anything*/response, /*String*/
				textStatus, /*jqXHR*/
				jqXHR) {
					pageSuccessCallback(response, textStatus, jqXHR);
					$("#outputText").val(response.msg);
				});
		invoker.setErrorCallback(pageErrorCallback);
		invoker.setBeforeSendCallback(pageBeforeSendCallback);
		invoker.setCompleteCallback(pageCompleteCallback);
		invoker.invoke(item);
	}
</script>
<style>
#preloader {
	display: none;
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: rgba(53, 147, 1, 0.7);
	z-index: 99;
	height: 100%;
}

#status {
	width: 200px;
	height: 200px;
	position: absolute;
	left: 50%;
	top: 50%;
	background-image: url(ajax-loader.gif);
	background-repeat: no-repeat;
	background-position: center;
	margin: -100px 0 0 -100px;
}
</style>
</head>
<body>
	<input type="button" value="echo" onClick="echo();" />&nbsp;
	<input type="button" value="test" onClick="test();" />&nbsp;
	<input type="button" value="open" onClick="openWindow();" />&nbsp;
	<input type="button" value="b64" onClick="getBase64FromText();" />&nbsp;
	<input type="button" value="Firmar" onClick="sign();" />&nbsp;&nbsp;&nbsp;
	<input type="button" value="exit" onClick="exit_jnlp();">&nbsp;

		<br />
		<div id="resultado"></div>

		<div>
			<span>Consola</span> <br> <textarea id="console" cols="150"
					rows="10">
		 </textarea>
		</div>
		<div>
			<span>Texto que se va a firmar</span> <br> <textarea
					id="inputText" cols="150" rows="10"></textarea>
		</div> <br>

			<div>
				<span>Texto firmado en base64</span> <br />
				<textarea id="outputText" cols="150" rows="10"></textarea>
			</div> <br />
			<div id="preloader">
				<div id="status">&nbsp;</div>
			</div>
</body>
</html>

